
# [游戏脚本高级编程](Game.Scripting.Mastery)

## 目录
- 第1篇 脚本编程的基本原理
  - [第1章 脚本编程概论]
  - [第2章 脚本编程系统的应用]
- 第2篇 基于命令的脚本

## **[第一章 脚本编程概论]**

### 1.1. 什么是脚本编程
* 假设开发一款角色扮演游戏（RPG）
* 设计文档
* 引擎 + 图形 + 音乐 + 声音

### 1.2 结构化游戏内容————一种简单的游戏设计方法
* 测试-修改-测试
* 问题：细微调整，都要重新编译整个游戏。
* 游戏和引擎放在一起编写时一种非常拙劣的组事物的方法。

### 1.3 通过将逻辑和具体实现相互分离来改善这种方法
* 改进：逻辑和具体实现相互分离
* 所有类型的脚本编程背后的基本原则————如何避免硬编码。

### 1.4 硬编码的危险性

### 1.5 将功能函数存放到外部文件

* 答案：脚本
* 脚本可以使你真正在游戏引擎之外编写代码，然后再将这些代码加载到游戏引擎之中并对它加以执行。
* 脚本就像是运行在游戏内部的小程序，它们的工作原理和其他普通程序一样。
* 游戏和脚本是分离的。

### 1.6 脚本是如何运行的
* 制定总体目标：游戏内容和游戏引擎分开。
  * 必须能够使用类似于C/C++这样的高级语言来编写代码。
  * 代码可以独立于游戏引擎单独编译
  * 可以在需要的任何时候装载和执行。

#### 1.6.1 计算机程序概述
* 编译器：高级语言代码转化为机器码。
* 机器码负责通知处理器执行某个特别具体的任务。
* 机器码必须是机器中最底层的代码。
* 机器码何其简单，编译器何其复杂。
* 链接器(linker)
  * 将输入的大量指令集（编译器编译的代码）封装在一个带有一定头信息的、简洁紧凑的可执行文件。
  * 并最终生成一个.EXE（或是其他系统使用的扩展名）。
* 运行可执行文件时
  * 操作系统调用程序装载器programe loader(简写为loader)。
  * loader负责将代码从.EXE文件中抽取出来并将其加载到内存中。
  * 然后通知cpu内存中第一条需要处理的指令的地址，也称为程序的入口点（the program entry point，如典型的主函数main()的入口地址）

* 计算机科学背后的哲学体系：问题 + 算法 ——> 高级语言代码 ——> 低级语言代码 ——> CPU执行。


#### 1.6.2 脚本编程概述
* 相似点：编写脚本和编写程序类似，执行过程类似。
* 区别：
  * 程序编译成机器码，直接运行在CPU（硬件）。
  * 脚本编译成字节码，运行在虚拟机(virtual machine, VM)。
* 虚拟机
  * 是软件，一个特殊的"模型"，可以产生其他程序或与之集成。
  * 与虚拟机集成的程序称为主应用程序（host application）。
  * 创立一门低级的汇编语言，即虚拟机器码（virtual machine code）
  * 脚本编译器，将脚本转换成虚拟机器码。
  * 脚本装载器，将虚拟机器码从脚本文件中载入。
* 交互过程
  * [图1.4 交互过程]()

### 1.7 脚本系统的基本类型

#### 1.7.1 面向过程的语言系统和面向对象的语言系统
* 主流脚本编程系统中最常使用的语言
  * 面向过程语言
  * 面向对象语言
* Unreal、UnrealScript

#### 1.7.2 基于命令的语言系统
* 像LOGO语言一样
* 宏（macro）
* 可以认为：
  * HTML是一种基于命令的脚本
  * albeit是一种形式更加复杂的脚本

#### 1.7.3 动态链接的模块系统
* 动态链接脚本模块（dynamically linked script modules）。
* 类比：Win32 DLLS
* 插件（add-ons）、mods（modification的简写）。
* 刚开始，动态链接模块被看作是脚本编程的最终方法。

#### 1.7.4 编译型代码和解释型代码
* 解释器（interpreter）
  * 类似编译器
  * 几乎要具有编译器所有的复杂语言分解功能函数，而且速度得快。
  * 解释器不需要借助编译器，可以直接载入和执行代码。
  * 解释器会执行一步内部的预编译，生成一个暂时的in-memory编译文件。

#### 1.7.5 现有的脚本设计方法
* Ruby：
  * 面向对象
  * 侧重系统管理方便的工作
  * 具有一系列高级特性：垃圾收集、动态库装载、多线程
* Lua
  * 轻量级的强大的扩展编程语言
  * 面向过程
  * 明显特征：编写的程序可以对自身进行扩展
  * 编写游戏脚本的很普遍的选择
* Java
  * 被证明是一种可行的、特征丰富的编写脚本的语言
  * JVM对编译脚本来说是最优的多线程运行环境
  * 面向对象


## **[第2章 脚本编程系统的应用]**

### 2.1 编写脚本的普遍目的
* 根本原因：避免硬编码

### 2.2 角色扮演游戏（Role Playing Games，RPGs）
* 一般比其他类型游戏使用更多的脚本

#### 2.2.1 复杂而又有深度的故事情节
* 标记（flags）记录唱经典或者游戏世界中的现在状态
* 游戏标记数组（Game Flag Array）

#### 2.2.2 非玩家角色（None-Player Characters，NPCs）
* 设计脚本两种方法：
  * 一种是先设计一个类似于C/C++的语法体系，然后在需要的时候添加内容
  * 另一种是同时设计语法和语言的总体结构

#### 2.2.3 物品和武器

#### 2.2.4 敌人
* 敌人行为
  * 力量
  * 速度
  * 忍耐力
  * 装甲/防御
  * 恐惧
  * 智力
* RPG游戏中的打斗是一个持续不断的循环过程。
* 循环的每一次迭代过程，接手玩家和敌人的输入，管理他们之间的相互交互，计算他们行为的最终结果。

### 2.3 第一人称射击游戏（first-person shooters， fpss）

#### 2.3.1 物品、议题和开关
* 真实感
* 游戏世界的物品需要对你的行为产生反应，应该根据选择的交互方式产生不同的反应。
* 对象对对象的通信方式（object-to-object communication）
* 玩家可能完成的动作：
  * 射击
  * 使用
  * 推动/移动
  * 碰撞
* 基于事件的脚本通信（event-based scrpit communication）  

#### 2.3.2 敌人智能（Enemy AI）
* 人工智能（AI，即Artfactial Intelligence）
* 小组游戏（team play)
* 基于小组的游戏（group-based techniques）
* 脚本之间的通信（inter-script communication）
* 通信方式：
  * 引擎到脚本（engine-to-script）的通信方式
  * 脚本到脚本（script-to-script）的通信方式

### 2.4 总结
* 介绍了脚本可以应用在两种主要类型游戏中的方式